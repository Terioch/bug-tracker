@model DashboardViewModel;

@{
    ViewData["Title"] = "Dashboard";
}

<div>
    <div class="row g-4">
        <div class="col">
            <canvas id="ticketTypeChart" style="height: 200px"></canvas>
        </div>
        <div class="col">
            <canvas id="ticketPriorityChart" style="height: 200px" class=""></canvas>
        </div>
    </div>
    <div class="row g-4">
        <div class="col">
            <div>Recent Activity List</div>
        </div>
        <div class="col">
            <canvas id="ticketStatusChart" style="height: 200px">Status Bar Chart</canvas>
        </div>
    </div>    
</div>

@section Scripts {
    <script type="text/javascript">
        // Colours: 
        // Blue: #417FEF
        // Grey: #ADB5BD
        // Light Blue: #17A2B8
        // Dark Grey: #343A40
        // Green: #00B973
        // Orange: #F0AD4E
        // Red: #D9534F        
        class ChartRenderer {
            constructor() {
                console.log("Initialized Chart");                
                this.renderTypeChart(); 
                this.renderStatusChart();
                this.renderPriorityChart();
            }

            // Render view and then fetch data from the server
            async renderTypeChart() {                
                const context = document.getElementById("ticketTypeChart");  
                const response = await fetch("chart/getTicketTypeData");
                const data = await response.json();
                
                const ticketTypeChart = new Chart(context, {
                    type: "doughnut",
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: "Tickets by Type",
                            backgroundColor: [  
                                '#D9534F',
                                '#417FEF',
                                '#00B973',                                                                
                                '#F0AD4E',                                                              
                            ],                    
                            data: data.values,
                        }],
                    },                    
                    options: {
                        title: {
                            display: true,
                            text: "Tickets by Type"
                        },    
                        responsive: false,
                    }
                });
            }

            async renderStatusChart() {                
                const context = document.getElementById("ticketStatusChart");  
                const response = await fetch("chart/getTicketStatusData");
                const data = await response.json();
                
                const ticketTypeChart = new Chart(context, {
                    type: "bar",
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: "Tickets by Status",
                            backgroundColor: [                                
                                '#ADB5BD',
                                '#F0AD4E',                                
                                '#417FEF',
                                '#17A2B8',                               
                                '#00B973',
                            ],                    
                            data: data.values,
                        }],
                    },                    
                    options: {
                        title: {
                            display: true,
                            text: "Tickets by Status"
                        },
                        responsive: false,
                        indexAxis: "x",
                        scales: {
                            x: {
                                beginAtZero: true
                            }
                        }
                    }                        
                });
            }

            async renderPriorityChart() {                
                const context = document.getElementById("ticketPriorityChart");  
                const response = await fetch("chart/getTicketPriorityData");
                const data = await response.json();
                
                const ticketPriorityChart = new Chart(context, {
                    type: "pie",
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: "Tickets by Priority",
                            backgroundColor: [   
                                '#00B973',
                                '#417FEF',                                                               
                                '#D9534F',                                                            
                            ],                    
                            data: data.values,
                        }],
                    },                    
                    options: {
                        title: {
                            display: true,
                            text: "Tickets by Priority"
                        },
                        responsive: false,
                    }                    
                });
            }

            // Load data on the server and then serialize to json
            @*renderTypeChart() {                
                const context = document.getElementById("ticketTypeChart");                     
                const ticketTypeChart = new Chart(context, {
                    type: "doughnut",
                    data: {
                        labels: @Html.Raw(Json.Serialize(Model.TicketTypeData.Labels)),
                        datasets: [{
                            label: "Tickets by Type",
                            backgroundColor: [                                
                                'rgb(60,141,188)',
                                'rgb(243,156,17)',
                                'rgb(0,166,90)',
                                'rgb(221,76,57)',
                                'rgb(0, 192, 239)',                               
                            ],
                            data: @Html.Raw(Json.Serialize(Model.TicketTypeData.Values)),
                        }],
                    },                    
                    options: {
                        scales: {
                            x: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            renderStatusChart() {                
                const context = document.getElementById("ticketStatusChart");                     
                const ticketStatusChart = new Chart(context, {
                    type: "bar",
                    data: {
                        labels: @Html.Raw(Json.Serialize(Model.TicketStatusData.Labels)),
                        datasets: [{
                            label: "Tickets by Status",
                            backgroundColor: [                                
                                'rgb(60,141,188)',
                                'rgb(243,156,17)',
                                'rgb(0,166,90)',
                                'rgb(221,76,57)',
                                'rgb(0, 192, 239)',                               
                            ],
                            data: @Html.Raw(Json.Serialize(Model.TicketStatusData.Values)),
                        }],
                    },                    
                    options: {
                        title: {
                            display: true,
                            text: "Tickets by Status"
                        },
                        scales: {
                            x: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            renderPriorityChart() {                
                const context = document.getElementById("ticketPriorityChart");                     
                const ticketPriorityChart = new Chart(context, {
                    type: "pie",
                    data: {
                        labels: @Html.Raw(Json.Serialize(Model.TicketPriorityData.Labels)),
                        datasets: [{
                            label: "Tickets by Priority",
                            backgroundColor: [                                
                                'rgb(60,141,188)',
                                'rgb(243,156,17)',
                                'rgb(0,166,90)',
                                'rgb(221,76,57)',
                                'rgb(0, 192, 239)',                               
                            ],                            
                            data: @Html.Raw(Json.Serialize(Model.TicketPriorityData.Values)),
                        }],
                    },                    
                    options: {                       
                        title: {
                            display: true,
                            text: "Tickets by Priority"
                        },                                                    
                    }
                });
            }*@                        
        }

        const chartRenderer = new ChartRenderer();
    </script>
}